parameters:
  - name: modelPath
    type: string
    default: 'taxi-model@latest'
  - name: storageAccount
    type: string
  - name: containerName
    type: string
    default: 'models'

steps:
  - task: AzureCLI@2
    displayName: 'Get model file path'
    inputs:
      azureSubscription: $(ado_service_connection_aml_ws)
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        model_path=$(az ml model show -n ${{ parameters.modelPath }} --query 'artifactPath' -o tsv)
        echo "##vso[task.setvariable variable=modelFilePath]$model_path"
  - task: AzureFileCopy@4
    displayName: 'Copy model file to Blob Storage'
    inputs:
      SourcePath: '$(modelFilePath)'
      azureSubscription: $(ado_service_connection_aml_ws)
      Destination: 'AzureBlob'
      storage: '${{ parameters.storageAccount }}'
      ContainerName: '${{ parameters.containerName }}'
      BlobPrefix: '$(modelFilePath)'