steps:
  - task: AzureCLI@2
    displayName: 'Get model file path'
    inputs:
      azureSubscription: $(ado_service_connection_aml_ws)
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        latest_model_version=$(az ml model list -n taxi-model --query "[?name=='taxi-model'].version" -o tsv | sort -r | head -n 1)
        model_path=$(az ml model show -n taxi-model --version $latest_model_version --query 'artifactPath' -o tsv)
        echo "Model path: $model_path"  # Debug output
        echo "##vso[task.setvariable variable=modelFilePath]$model_path"
  - task: AzureCLI@2
    displayName: 'Copy model file to Blob Storage'
    inputs:
      azureSubscription: $(ado_service_connection_rg)
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        az storage blob upload --account-name $(storage_account) --container-name models --name $(modelFilePath) --type block --file $(modelFilePath)